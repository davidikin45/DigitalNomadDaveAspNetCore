!function(){"use strict";window.onerror=function(e){window.alerts?window.alerts.error("There was a problem with your last action.  Please reload the page, then try again."):alert("Something serious went wrong.  Please close browser, then try again.")},window.app=angular.module("DND",["ui.bootstrap","ngMap"]),window.app.run(["$http","$rootScope","$templateCache","NgMap",function(e,t,r,n){n.getMap().then(function(e){console.log("map initialized"),t.map=e}).catch(function(e){console.error("map error: ",e)})}]),window.app.controller("MapCtrl",["$compile","NgMap",function(e,t){this.openGoogleMap=function(e,t){var r="https://www.google.com/maps/search/?api=1&query="+this.position.lat()+","+this.position.lng();t&&(r=r+"&query_place_id="+t),window.open(r,"_blank")},this.openLocation=function(e,t){window.location.href="/locations/"+t}}]),window.app.factory("alerts",[function(){return window.alerts}]),window.app.factory("$exceptionHandler",["$log","alerts",function(e,t){return function(r,n){t.error("There was a problem with your last action.  Please reload the page, then try again."),e.error(r,n)}}]),window.app.service("LoadingInterceptor",["$q","$rootScope","$log",function(e,t,r){function n(){t.loading=i<o}var o=0,i=0;return{request:function(t){return o++,n(),t||e.when(t)},requestError:function(t){return i++,n(),r.error("Request error:",t),e.reject(t)},response:function(t){return i++,n(),t||e.when(t)},responseError:function(o){return i++,n(),r.error("Response error:",o),t.error=o.data.error,t.errors=o.data.errors,$("#error").modal("show"),e.reject(o)}}}]),window.app.config(["$httpProvider",function(e){e.interceptors.push("LoadingInterceptor")}]),window.app.config(["$locationProvider",function(e){}]),window.app.config(["$sceDelegateProvider",function(e){e.resourceUrlWhitelist(["self","https://www.google.com/**"])}]),window.app.config(["$uibModalProvider",function(e){e.options.windowClass="modal-fullscreen",e.options.backdropClass="modal-backdrop-fullscreen",e.options.backdrop="static"}])}(),function(){"use strict";function e(e,r,n,o,i,a,l){var c=this;c.close=function(){},c.openGoogleMapModal=function(){i.open({templateUrl:"/site/template/googleMapModal.tmpl.cshtml",scope:o,bindToController:!0,controller:t,controllerAs:"vm",resolve:{latitude:function(){return c.latitude},longitude:function(){return c.longitude},placeid:function(){return c.placeid},NgMap:function(){return l},$sce:function(){return a}}})}}function t(e,t,r,n,o){var i=this;i.latitude=r,i.longitude=n,i.placeid=o,i.trustSrc=function(t){var r="";return r=i.placeid?"https://www.google.com/maps/embed/v1/place?q=place_id:"+i.placeid+"&zoom=6&key="+t:"https://www.google.com/maps/embed/v1/place?q="+i.latitude+","+i.longitude+"&zoom=6&key="+t,e.trustAsResourceUrl(r)}}window.app.directive("googleMap",function(){return{templateUrl:"/site/template/googleMap.tmpl.cshtml",controller:e,bindToController:{placeid:"@",latitude:"@",longitude:"@"},scope:{},controllerAs:"vm"}}),e.$inject=["$window","$filter","$rootScope","$scope","$modal","$sce","NgMap"],t.$inject=["$sce","NgMap","latitude","longitude","placeid"]}(),function(){"use strict";function e(t,r,n,o,i,a){function l(){c()?h.selectedView="simpleSearch":h.selectedView="advancedSearch"}function c(){return location.hash.slice(1).split("&").length>1}function s(){}function u(){h.flightSearch.sortType="Price",h.flightSearch.sortOrder="Asc"}function p(){h.saving=!0;var e=new Date,t=(new Date(e.getFullYear(),e.getMonth(),e.getDate()+1),{});t.returnFlight=h.flightSearch.returnFlight,t.originLocation=h.flightSearch.originLocation.placeId,t.destinationLocation=h.flightSearch.destinationLocation.placeId,t.outboundDate=r("date")(new Date(h.flightSearch.outboundDate),"yyyy-MM-dd"),t.returnFlight&&(t.inboundDate=r("date")(new Date(h.flightSearch.inboundDate),"yyyy-MM-dd")),t.adults=h.flightSearch.adults,t.children=h.flightSearch.children,t.infants=h.flightSearch.infants,t.flightClass=h.flightSearch.flightClass,t.directFlightsOnly=h.flightSearch.directFlightsOnly,t.sortType=h.flightSearch.sortType,t.sortOrder=h.flightSearch.sortOrder,a.searchRedirect(t),l()}var h=this;h.search=p,h.isLoading=!1,h.openFilterModal=function(){i.open({templateUrl:"/flightsearch/template/flightSearchFilters.tmpl.cshtml",scope:o,controller:e,controllerAs:h}).rendered.then(function(){n.$broadcast("rzSliderForceRender")})},h.closeFilterModal=function(){c()&&p()},h.openSortModal=function(){i.open({templateUrl:"/flightsearch/template/flightSearchSort.tmpl.cshtml",scope:o,controller:e,controllerAs:h})},h.closeSortModal=function(){c()&&p()},h.resetSort=u,h.resetFilters=s,h.selectedView="advancedSearch",h.setView=function(e){h.selectedView=e},h.originLocation="",h.destinationLocation="",h.flightSearch={originLocation:{placeId:"nearest",placeName:"Nearest Airport"},returnFlight:!0,adults:"1",children:"0",infants:"0",flightClass:"Economy",directFlightsOnly:!0,outboundDate:new Date,inboundDate:new Date(Date.now()+864e5)},u(),l(),h.getLocation=function(e){return a.locationAutoSuggest({search:e}).then(function(e){return e.data.locations})},h.errorMessage=null,n.$on("search",function(e,t){c()&&p()})}window.app.directive("flightSearch",function(){return{templateUrl:"/flightSearch/template/flightSearch.tmpl.cshtml",controller:e,bindToController:!0,scope:!0,controllerAs:"vm"}}),window.app.controller("FlightSearchController",e),e.$inject=["$window","$filter","$rootScope","$scope","$modal","flightSearchSvc"]}(),function(){"use strict";function e(e,t,r){var n=this;n.itinerary=e.itinerary,n.selectedView="details",n.setView=function(e){n.selectedView=e},n.map=function(){t.open({template:'<itinerary-map itinerary="itinerary" />',scope:angular.extend(e.$new(!0),{itinerary:n.itinerary})})}}window.app.directive("flightSearchItinerary",function(){return{scope:{itinerary:"="},replace:!0,templateUrl:"/flightSearch/template/flightSearchItinerary.tmpl.cshtml",controller:e,controllerAs:"vm"}}),e.$inject=["$scope","$modal","flightSearchSvc"]}(),function(){"use strict";function e(e,t,r,n,o){function i(){var e={};return location.hash.slice(1).split("&").forEach(function(t){t=t.split("="),e[t[0]]=decodeURIComponent(t[1]||"")}),JSON.parse(JSON.stringify(e))}function a(){l.isLoading=!0;var t=i();t.skip=0,t.take=l.take,e.search(t).success(function(e){l.searchResults=e}).error(function(e){l.errorMessage="There was a problem searching: "+e}).finally(function(){l.isLoading=!1})}var l=this;l.search=a,l.isLoading=!1,l.errorMessage=null,l.take=10,l.loadMore=function(){l.take+=10;var e=i();e.take=l.take;var r=t(e);location.hash="#"+r},l.openFilters=function(){r.open({templateUrl:"/flightsearch/template/flightSearchFilters.tmpl.cshtml",scope:n,controller:controller,controllerAs:l}).rendered.then(function(){o.$broadcast("rzSliderForceRender")})};var c=i();c?(l.flightSearch=c,l.flightSearch.outboundDate=new Date(l.flightSearch.outboundDate),l.flightSearch.inboundDate=new Date(l.flightSearch.inboundDate)):l.flightSearch={returnFlight:!0,adults:"1",children:"0",infants:"0",flightClass:"0",directFlightsOnly:!0,priceFilterPerAdultMin:0,priceFilterPerAdultMax:1e3,outboundDepartureTimeFrom:0,outboundDepartureTimeTo:1440,outboundArrivalTimeFrom:0,outboundArrivalTimeTo:1440,inboundDepartureTimeFrom:0,inboundDepartureTimeTo:1440,inboundArrivalTimeFrom:0,inboundArrivalTimeTo:1440,outboundDurationMin:0,outboundDurationMax:1440,inboundDurationMin:0,inboundDurationMax:1440},a(),$(window).on("hashchange",function(){l.searchResults=[],a()})}window.app.directive("flightSearchResults",function(){return{templateUrl:"/flightSearch/template/flightSearchResults.tmpl.cshtml",controller:e,controllerAs:"vm"}}),e.$inject=["flightSearchSvc","$httpParamSerializer","$modal","$scope","$rootScope"]}(),function(){function e(e,t,r,n){return{search:function(e){return e.locale="en-GB",e.market=["AU"],e.currency="GBP",n.post("/api/flight-search",e)},searchRedirect:function(r){r.locale="en-GB",r.market=["AU"],r.currency="GBP",r.skip=0,r.take=10;var n=t(r),o="http://"+e.location.host+"/flight-search-results#"+n;window.location.href=o},locationAutoSuggest:function(e){return e.locale="en-GB",e.market=["AU"],e.currency="GBP",n.post("/api/flight-search-location/auto-suggest",e)},location:function(e){return e.locale="en-GB",e.market=["AU"],e.currency="GBP",n.post("/api/flight-search-location",e)}}}window.app.factory("flightSearchSvc",e),e.$inject=["$window","$httpParamSerializer","$rootScope","$http"]}(),function(){"use strict";Object.defineProperty(Array.prototype,"count",{get:function(){return this.length}}),Array.prototype.addRange||(Array.prototype.addRange=function(e){this.push.apply(this,e)})}(),function(){function e(e){var t=$(n(e));r.append(t),window.setTimeout(function(){t.fadeOut()},3e3)}var t={showAlert:e,success:function(t){e({alertClass:"alert-success",message:t})},info:function(t){e({alertClass:"alert-info",message:t})},warning:function(t){e({alertClass:"alert-warning",message:t})},error:function(t){e({alertClass:"alert-danger",message:t})}};window.alerts=t;var r=$(".alert-container"),n=_.template("<div class='alert <%= alertClass %> alert-dismissable'><button type='button' class='close' data-dismiss='alert' aria-hidden='true'>&times;</button><%= message %></div>")}(),function(){window.app.filter("parseDate",function(){return function(e){return"string"!=typeof e||-1===e.indexOf("/Date")?e:new Date(parseInt(e.substr(6)))}})}();